/*
Name:  Quinn Miyamoto
Email: qmiyamoto@g.hmc.edu
Date:  September 21, 2025

Purpose: To play various songs as directed.
*/


#include "STM32L432KC_RCC.h"
#include "STM32L432KC_FLASH.h"
#include "STM32L432KC_GPIO.h"
#include "TIM15_struct.h"
#include "TIM16_struct.h"


// Fur Elise notes
// {pitch (Hz), duration (ms)}
const int fur_elise_notes[][2] = 
{
  {659,	125},
  {623,	125},
  {659,	125},
  {623,	125},
  {659,	125},
  {494,	125},
  {587,	125},
  {523,	125},
  {440,	250},
  {  0,	125},
  {262,	125},
  {330,	125},
  {440,	125},
  {494,	250},
  {  0,	125},
  {330,	125},
  {416,	125},
  {494,	125},
  {523,	250},
  {  0,	125},
  {330,	125},
  {659,	125},
  {623,	125},
  {659,	125},
  {623,	125},
  {659,	125},
  {494,	125},
  {587,	125},
  {523,	125},
  {440,	250},
  {  0,	125},
  {262,	125},
  {330,	125},
  {440,	125},
  {494,	250},
  {  0,	125},
  {330,	125},
  {523,	125},
  {494,	125},
  {440,	250},
  {  0,	125},
  {494,	125},
  {523,	125},
  {587,	125},
  {659,	375},
  {392,	125},
  {699,	125},
  {659,	125},
  {587,	375},
  {349,	125},
  {659,	125},
  {587,	125},
  {523,	375},
  {330,	125},
  {587,	125},
  {523,	125},
  {494,	250},
  {  0,	125},
  {330,	125},
  {659,	125},
  {  0,	250},
  {659,	125},
  {1319,125},
  {  0,	250},
  {623,	125},
  {659,	125},
  {  0,	250},
  {623,	125},
  {659,	125},
  {623,	125},
  {659,	125},
  {623,	125},
  {659,	125},
  {494,	125},
  {587,	125},
  {523,	125},
  {440,	250},
  {  0,	125},
  {262,	125},
  {330,	125},
  {440,	125},
  {494,	250},
  {  0,	125},
  {330,	125},
  {416,	125},
  {494,	125},
  {523,	250},
  {  0,	125},
  {330,	125},
  {659,	125},
  {623,	125},
  {659,	125},
  {623,	125},
  {659,	125},
  {494,	125},
  {587,	125},
  {523,	125},
  {440,	250},
  {  0,	125},
  {262,	125},
  {330,	125},
  {440,	125},
  {494,	250},
  {  0,	125},
  {330,	125},
  {523,	125},
  {494,	125},
  {440,	500},
  {0, 20000}
  // {0, 0}
};


// Legendary notes
// {pitch (Hz), duration (ms)}
const int legendary_notes[][2] = 
{
  {392, 125}, // gg -> G4
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {493, 125}, // bb -> B4
  {440, 63},  // a  -> A4
  {493, 63},  // b  -> B4
  {493, 63},  // b  -> B4
  {523, 125}, // CC -> C5
  {392, 63},  // g  -> G4
  {392, 125}, // gg -> G4
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {493, 125}, // bb -> B4
  {440, 63},  // a  -> A4
  {493, 125}, // bb -> B4
  {523, 125}, // CC -> C5
  {392, 63},  // g  -> G4
  {349, 125}, // ff -> F4
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {493, 125}, // bb -> B4
  {440, 63},  // a  -> A4
  {493, 125}, // bb -> B4
  {523, 125}, // CC -> C5
  {392, 63},  // g  -> G4
  {392, 125}, // gg -> G4
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {493, 125}, // bb -> B4
  {440, 63},  // a  -> A4
  {493, 125}, // bb -> B4
  {493, 63},  // b  -> B4
  {523, 125}, // CC -> C5
  {392, 125}, // gg -> G4
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {493, 125}, // bb -> B4
  {440, 63},  // a  -> A4
  {493, 125}, // bb -> B4
  {493, 63},  // b  -> B4
  {523, 125}, // CC -> C5

  {0, 250},   // XXXX

  {523, 125}, // CC -> C5
  {523, 125}, // CC -> C5
  {493, 125}, // bb -> B4
  {440, 63},  // a  -> A4
  {392, 125}, // gg -> G4
  {392, 63},  // g  -> G4
  {330, 63},  // e  -> E4
  {294, 125}, // dd -> D4
  {294, 125}, // dd -> D4
  {294, 63},  // d  -> D4

  {0, 250},   // XXXX

  {587, 63},  // D  -> D5
  {587, 63},  // D  -> D5
  {587, 63},  // D  -> D5
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {440, 125}, // aa -> A4
  {440, 63},  // a  -> A4
  {523, 125}, // CC -> C5
  {440, 125}, // aa -> A4
  {523, 125}, // CC -> C5
  {587, 125}, // DD -> D5
  {659, 63},  // E  -> E5
  {587, 125}, // DD -> D5
  {784, 125}, // GG -> G5
  {587, 125}, // DD -> D5
  {587, 125}, // DD -> D5
  {587, 63},  // D  -> D5

  {0, 250},   // XXXX

  {698, 63},  // F  -> F5
  {698, 63},  // F  -> F5
  {698, 63},  // F  -> F5
  {698, 125}, // FF -> F5
  {659, 125}, // EE -> E5
  {440, 125}, // aa -> A4
  {440, 63},  // a  -> A4
  {392, 125}, // gg -> G4

  {0, 125},   // XX

  {392, 125}, // gg -> G4
  {587, 125}, // DD -> D5
  {587, 63},  // D  -> D5
  {659, 63},  // E  -> E5
  {587, 125}, // DD -> D5
  {392, 63},  // g  -> G4
  {587, 125}, // DD -> D5
  {587, 63},  // D  -> D5
  

  {0, 250},   // XXXX
  {0, 63},    // X
  
  {392, 63},  // g  -> G4
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {523, 63},  // C  -> C5
  {440, 125}, // aa -> A4
  {440, 63},  // a  -> A4
  {523, 125}, // CC -> C5
  {440, 125}, // aa -> A4
  {523, 125}, // CC -> C5
  {587, 125}, // DD -> D5
  {659, 63},  // E  -> E5
  {587, 125}, // DD -> D5
  {587, 63},  // D  -> D5
  {392, 125}, // gg -> G4
  {587, 125}, // DD -> D5

  {0, 500},   // XXXXXXXX

  {392, 125}, // gg -> G4
  {659, 125}, // (E -> E5
  {659, 125},
  {587, 125}, // D  -> D5
  {587, 125},
  {523, 125},
  {523, 125}, // C) -> C5
  {349, 125}, // ff -> F4
  {523, 125}, // CC -> C5
  {523, 125}, // CC -> C5
  {523, 125}, // CC -> C5
  {659, 125}, // EE -> E5
  {659, 125}, // EE -> E5
  {659, 125}, // (E -> E5
  {659, 125},
  {587, 125}, // D  -> D5
  {587, 125},
  {523, 125},
  {523, 125}, // C) -> C5
  {392, 125}, // gg -> G4
  {392, 125}, // gg -> G4
  {392, 125}, // gg -> G4
  {392, 125}, // gg -> G4

  {0, 125},   // XX
  {0, 63},    // X

  {392, 63},  // g  -> G4
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {698, 125}, // FF -> F5
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {587, 125}, // DD -> D5
  {523, 125}, // CC -> C5
  
  {0, 63},    // X

  {523, 63},  // C  -> C5
  {523, 125}, // CC -> C5
  {587, 125}, // DD -> D5
  {493, 125}, // bb -> B4
  {493, 125}, // bb -> B4
  {493, 125}, // bb -> B4
  {493, 125}, // bb -> B4

  {0, 250},   // XXXX

  {659, 125}, // (E -> E5
  {659, 125},
  {587, 125}, // D  -> D5
  {587, 125},
  {523, 125},
  {523, 125}, // C) -> C5
  {349, 125}, // ff -> F4
  {523, 125}, // CC -> C5
  {523, 125}, // CC -> C5
  {523, 63},  // C  -> C5

  {0, 125},   // XX
  
  {659, 63},  // E  -> E5
  {659, 63},  // E  -> E5
  {659, 125}, // (E -> E5
  {659, 125},
  {587, 125}, // D  -> D5
  {587, 125},
  {523, 125},
  {523, 125}, // C) -> C5
  {392, 125}, // gg -> G4
  {392, 125}, // gg -> G4
  {392, 125}, // gg -> G4
  {392, 125}, // gg -> G4

  {0, 125},   // XX
  {0, 125},   // XX
  {0, 125},   // XX

  {587, 63},  // D  -> D5
  {659, 63},  // E  -> E5
  {698, 125}, // FF -> F5
  {659, 125}, // EE -> E5
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {587, 63},  // D  -> D5
  {523, 125}, // CC -> C5
  {523, 63},  // C  -> C5
  {523, 125}, // CC -> C5
  {587, 125}, // DD -> D5
  {493, 125}, // bb -> B4
  {493, 125}, // bb -> B4
  {493, 125}, // bb -> B4
  {493, 125}, // bb -> B4

  {0, 250},   // XXXX

  {392, 63},  // g  -> G4
  {523, 125}, // CC -> C5
  {392, 63},  // g  -> G4

  {0, 250},   // XXXX

  {587, 63},  // D  -> D5
  {659, 125}, // EE -> E5
  {659, 125}, // EE -> E5
  {587, 63},  // D  -> D5
  {659, 63},  // E  -> E5
  {587, 63},  // D  -> D5
  {659, 125}, // EE -> E5
  {523, 125}, // CC -> C5

  {0, 250},   // XXXX

  {659, 63},  // E  -> E5
  {659, 125}, // EE -> E5
  {659, 125}, // EE -> E5
  {587, 63},  // D  -> D5
  {659, 63},  // E  -> E5
  {587, 63},  // D  -> D5
  {659, 125}, // EE -> E5
  {523, 125}, // CC -> C5
  {392, 125}, // gg -> G4
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {493, 125}, // bb -> B4
  {440, 63},  // a  -> A4
  {493, 125}, // bb -> B4
  {523, 125}, // CC -> C5
  {392, 63},  // g  -> G4
  {392, 125}, // gg -> G4
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {493, 125}, // bb -> B4
  {440, 63},  // a  -> A4
  {493, 125}, // bb -> B4
  {493, 63},  // b  -> B4
  {523, 125}, // CC -> C5

  {0, 125},   // XX
  {0, 63},    // X

  {392, 63},  // g  -> G4
  {587, 63},  // D  -> D5
  {659, 125}, // EE -> E5
  {659, 125}, // EE -> E5
  {587, 63},  // D  -> D5
  {659, 63},  // E  -> E5
  {587, 63},  // D  -> D5
  {659, 125}, // EE -> E5
  {523, 125}, // CC -> C5

  {0, 125},   // XX
  {0, 63},    // X

  {523, 63},  // C  -> C5
  {587, 63},  // D  -> D5
  {659, 125}, // EE -> E5
  {698, 125}, // FF -> F5
  {659, 125}, // EE -> E5
  {587, 63},  // D  -> D5
  {523, 125}, // CC -> C5
  {493, 125}, // bb -> B4
  {392, 125}, // gg -> G4
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5
  {493, 125}, // bb -> B4
  {440, 63},  // a  -> A4
  {493, 125}, // bb -> B4
  {523, 125}, // CC -> C5
  {392, 63},  // g  -> G4
  {392, 125}, // gg -> G4
  {659, 125}, // EE -> E5
  {587, 125}, // DD -> D5
  {659, 125}, // EE -> E5

  {493, 125}, // bb -> B4
  {440, 63},  // a  -> A4
  {493, 125}, // bb -> B4
  {493, 63},  // b  -> B4
  {523, 125}, // CC -> C5

  {0, 0}
};


// plays Fur Elise
int main(void)
{

  // configures the system clock
  configureFlash();
  configureClock();

  // enables GPIO port A
  RCC -> AHB2ENR |= (1 << 0);

  // enables both timers
  RCC -> APB2ENR |= (1 << 16); RCC -> APB2ENR |= (1 << 17);

  // sets PA6 to alternating function
  pinMode(6, 2);

  // enables AF14 for the GPIO pin PA6
  GPIO -> AFRL &= ~(1 << 24); GPIO -> AFRL |= (1 << 25); GPIO -> AFRL |= (1 << 26); GPIO -> AFRL |= (1 << 27); 

  // initializes the note frequency- and duration-generating functions
  PWM_duration_initialization();
  PWM_generation_initialization();

  // calculates the total length of the song
  int fur_elise_song_length = sizeof(fur_elise_notes) / sizeof(fur_elise_notes[0]);

  // loops through every note of Fur Elise, as provided in the above array
  for (int i = 0; i < fur_elise_song_length; i++) 
  {
    // generates each note's frequency 
    PWM_generation(fur_elise_notes[i][0]);

    // prolongs each note for however long is deemed necessary
    PWM_duration(fur_elise_notes[i][1]);
  }

  // calculates the total length of the song
  int legendary_song_length = sizeof(legendary_notes) / sizeof(legendary_notes[0]);

  // loops through every note of Fur Elise, as provided in the above array
  for (int j = 0; j < legendary_song_length; j++) 
  {
    // generates each note's frequency 
    PWM_generation(legendary_notes[j][0]);

    // prolongs each note for however long is deemed necessary
    PWM_duration(2 * legendary_notes[j][1]);
  }

}

